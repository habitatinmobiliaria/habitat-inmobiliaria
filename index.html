<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hábitat Inmobiliaria</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f4f4;
      font-family: 'Segoe UI', sans-serif;
    }
    .container {
      margin-top: 40px;
    }
    .table thead {
      background-color: #0d6efd;
      color: white;
    }
    footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      background-color: #e9ecef;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">Hábitat Inmobiliaria</h1>
    <p class="text-center">Tu propiedad ideal te está esperando.</p>

    <form id="formulario" class="row g-3 mb-5">
      <div class="col-md-6">
        <label for="titulo" class="form-label">Título</label>
        <input type="text" id="titulo" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label for="precio" class="form-label">Precio (S/)</label>
        <input type="number" id="precio" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label for="distrito" class="form-label">Distrito</label>
        <input type="text" id="distrito" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label for="tipo" class="form-label">Tipo de propiedad</label>
        <select id="tipo" class="form-select" required>
          <option value="Departamento">Departamento</option>
          <option value="Casa">Casa</option>
          <option value="Terreno">Terreno</option>
        </select>
      </div>
      <div class="col-12">
        <label for="descripcion" class="form-label">Descripción</label>
        <textarea id="descripcion" class="form-control" rows="3" required></textarea>
      </div>
      <div class="col-12 text-end">
        <button type="submit" class="btn btn-primary">Registrar propiedad</button>
      </div>
    </form>

    <h2 class="mb-3">Propiedades registradas</h2>
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>Título</th>
          <th>Descripción</th>
          <th>Precio</th>
          <th>Distrito</th>
          <th>Tipo</th>
        </tr>
      </thead>
      <tbody id="lista-propiedades">
        <tr><td colspan="5" class="text-center">Cargando propiedades...</td></tr>
      </tbody>
    </table>
  </div>

  <footer>
    &copy; 2025 Hábitat Inmobiliaria - Todos los derechos reservados.
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient(
      'https://paktfgnzospbxnbvmyzc.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBha3RmZ256b3NwYnhuYnZteXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4OTc4MjYsImV4cCI6MjA2OTQ3MzgyNn0.GAxrht670Nc7IPd-3aikRa-eo5uTwVy1sbuqsbwUcQk'
    );

    async function cargarPropiedades() {
      const { data, error } = await supabase
        .from("propiedades")
        .select("*")
        .order("id", { ascending: false });

      const lista = document.getElementById("lista-propiedades");
      lista.innerHTML = "";

      if (error) {
        console.error("Error al cargar propiedades:", error);
        lista.innerHTML = `<tr><td colspan="5" class="text-danger">Error al cargar propiedades.</td></tr>`;
        return;
      }

      if (data.length === 0) {
        lista.innerHTML = `<tr><td colspan="5" class="text-center">No hay propiedades registradas.</td></tr>`;
        return;
      }

      data.forEach(p => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${p.titulo}</td>
          <td>${p.descripcion}</td>
          <td>S/ ${p.precio}</td>
          <td>${p.distrito}</td>
          <td>${p.tipo}</td>
        `;
        lista.appendChild(fila);
      });
    }

    document.getElementById("formulario").addEventListener("submit", async e => {
      e.preventDefault();
      const nueva = {
        titulo: document.getElementById("titulo").value.trim(),
        descripcion: document.getElementById("descripcion").value.trim(),
        precio: parseFloat(document.getElementById("precio").value),
        distrito: document.getElementById("distrito").value.trim(),
        tipo: document.getElementById("tipo").value.trim()
      };
      const { error } = await supabase.from("propiedades").insert([nueva]);
      if (error) {
        alert("Error al guardar: " + error.message);
      } else {
        e.target.reset();
        cargarPropiedades();
      }
    });

    cargarPropiedades();
  </script>
</body>
</html>
